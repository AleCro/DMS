import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import java.util.Arrays;
import java.util.List;
import static org.junit.jupiter.api.Assertions.*;

/**
 * FishTest.java
 * Unit test suite for the Fish class in the
 * Florida Native Fish Database Management System (DMS).
 *
 * Validates:
 * - Constructor defaults and clamping (averageSize > 0).
 * - Getters/setters for all fields.
 * - Measurement unit normalization and fallback.
 * - Proper output formatting in toString().
 */
public class FishTest {
    private Fish fish;
    private List<String> habitats;

    @BeforeEach
    void setUp() {
        habitats = Arrays.asList("River", "Lake");
        fish = new Fish(
                "Bass",
                "Micropterus salmoides",
                12.5,
                "insects, algae",
                habitats,
                "Least Concern",
                "001-00-0001"
        );
    }

    // ---- Constructor and Getter Tests ----
    @Test
    void testConstructorAndGetters() {
        assertEquals("Bass", fish.getCommonName());
        assertEquals("Micropterus salmoides", fish.getScientificName());
        assertEquals(12.5, fish.getAverageSize(), 0.0001);
        assertEquals("insects, algae", fish.getDiet());
        assertEquals(habitats, fish.getHabitats());
        assertEquals("Least Concern", fish.getConservationStatus());
        assertEquals("001-00-0001", fish.getTag());
        assertEquals("in", fish.getMeasurementUnit(),
                "Default measurement unit should be 'in'");
    }

    @Test
    void testConstructorClampsNegativeAverageSize() {
        Fish invalid = new Fish(
                "Goby",
                "Gobiidae sp.",
                -5.0,
                "plankton",
                List.of("Reef"),
                "Least Concern",
                "009-00-0009"
        );
        assertEquals(1.0, invalid.getAverageSize(), 0.0001,
                "Negative averageSize should clamp to 1.0 by constructor");
    }

    // ---- Setter Method Tests ----
    @Test
    void testSettersUpdateFields() {
        fish.setCommonName("Snook");
        fish.setScientificName("Centropomus undecimalis");
        fish.setAverageSize(20.0);
        fish.setDiet("shrimp, small fish");
        fish.setHabitats(List.of("Mangrove", "Estuary"));
        fish.setConservationStatus("Near Threatened");
        fish.setTag("002-00-0002");

        assertEquals("Snook", fish.getCommonName());
        assertEquals("Centropomus undecimalis", fish.getScientificName());
        assertEquals(20.0, fish.getAverageSize(), 0.0001);
        assertEquals("shrimp, small fish", fish.getDiet());
        assertEquals(List.of("Mangrove", "Estuary"), fish.getHabitats());
        assertEquals("Near Threatened", fish.getConservationStatus());
        assertEquals("002-00-0002", fish.getTag());
    }

    @Test
    void testSetAverageSizeRejectsInvalidValues() {
        double previous = fish.getAverageSize();
        fish.setAverageSize(0.0);
        assertEquals(previous, fish.getAverageSize(),
                "Setting non-positive averageSize should keep previous valid value");
        fish.setAverageSize(-10.0);
        assertEquals(previous, fish.getAverageSize(),
                "Negative averageSize should not overwrite previous value");
    }

    // ---- Measurement Unit Tests ----
    @Test
    void testMeasurementUnitAcceptsValidUnitsAndNormalizes() {
        String[] validUnits = {"mm", "cm", "m", "in", "ft", "yd"};
        for (String unit : validUnits) {
            fish.setMeasurementUnit(unit.toUpperCase());
            assertEquals(unit, fish.getMeasurementUnit(),
                    "Measurement unit should normalize to lowercase: " + unit);
        }
    }

    @Test
    void testMeasurementUnitInvalidRevertsToDefault() {
        fish.setMeasurementUnit("lightyears");
        assertEquals("in", fish.getMeasurementUnit(),
                "Invalid measurement unit should revert to 'in'");

        fish.setMeasurementUnit(null);
        assertEquals("in", fish.getMeasurementUnit(),
                "Null measurement unit should revert to 'in'");
    }

    // ---- toString() Output ----
    @Test
    void testToStringIncludesAllFields() {
        String result = fish.toString();
        assertTrue(result.contains("Common Name: Bass"));
        assertTrue(result.contains("Scientific Name: Micropterus salmoides"));
        assertTrue(result.contains("Average Size: 12.5 in"));
        assertTrue(result.contains("Diet: insects, algae"));
        assertTrue(result.contains("Habitats: River, Lake"));
        assertTrue(result.contains("Conservation Status: Least Concern"));
        assertTrue(result.contains("Tag: 001-00-0001"));
    }

    @Test
    void testToStringWithEmptyHabitats() {
        Fish empty = new Fish(
                "Guppy",
                "Poecilia reticulata",
                1.5,
                "plankton",
                List.of(),
                "Least Concern",
                "003-00-0003"
        );
        String result = empty.toString();
        assertTrue(result.contains("Habitats:"),
                "Habitats label should appear even if the list is empty");
    }
}
